<!doctype html>
<html>
<head>
  <meta charset="UTF-8">
  <script src="../../webcomponentsjs/webcomponents.min.js"></script>
  <script src="../../web-component-tester/browser.js"></script>
  <link rel="import" href="../github-gist.html">
</head>
<body>
  <github-gist gistid="e54a2ed1b12934d3e134"></github-gist>

  <script>

    var githubGist,
        counter;

    describe('<github-gist>', function() {
      before(function(){
        githubGist = document.querySelector('github-gist');
        counter = 0;
      });

      afterEach(function(done){
        githubGist.removeEventListener('github-gist-ready');
        githubGist.gistid = null;
        counter++;
        done();
      });

      // after(funciton(){
      //   counter = 0;
      //   done();
      // });

      function testValidGist(done){
        githubGist.addEventListener('github-gist-ready', function(e) {

          var scriptSrc = 'https://gist.github.com/' + e.detail.gistId + '.json?callback=getResponse_' + counter,
              defaultStylesheet = 'https://gist-assets.github.com/assets/embed-b67021dc07195830cc157f7720b938fb.css';

          flush(function(){
            assert.equal(githubGist.gistid, e.detail.gistId);
            assert.equal(githubGist.scriptEl.getAttribute('src'), scriptSrc);
            assert.equal(githubGist.defaultStylesheet, defaultStylesheet);
            assert.equal(githubGist.stylesheet, defaultStylesheet);
            assert.isNotNull(githubGist.styleEl);
            assert.isNotNull(githubGist.gistEl);
            assert.isNotNull(githubGist.gistEl.querySelector('.gist'));

            done();
          });
        });
      }

      it('should display gist on startup', function(done){
        testValidGist(done);
      });

      it('should display gist if gistid property changed and it\'s VALID', function(done){
        githubGist.setAttribute('gistid', 'a772e7d43f623e1109e4');
        testValidGist(done);
      });
    });
  </script>
</body>
</html>
